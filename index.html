<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dynamic Notion Calendar Widget</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }
    .calendar {
      display: grid;
      grid-template-columns: 20px repeat(7, 1fr); /* extra column for week numbers */
      gap: 1px;
      max-width: 700px;
      margin: auto;
    }
    .day, .empty, .weekday, .weeknum {
      padding: 10px;
      border: 0px solid #ccc;
      border-radius: 4px;
      transition: background 0.2s, color 0.2s;
    }
    .weekday {
      font-weight: bold;
      background: #f0f0f0;
    }
    .weeknum {
      font-weight: bold;
      background: #fafafa;
      text-align: center;
    }
    .weeknum a {
      text-decoration: none;
      color: #0070f3;
    }
    .weeknum:hover {
      background: #0070f3;
    }
    .weeknum:hover a {
      color: white;
    }
    .day a {
      text-decoration: none;
      color: #f0efeb;
    }
    .day:hover {
      background: #0070f3;
      color: white;
    }
    .day:hover a {
      color: white;
    }
    .day.today {
      background: #0070f3;
      color: white;
      font-weight: bold;
    }
    .day.today a {
      color: white;
    }
    .day.weekend {
      background: #f9f2f2; /* subtle weekend shading */
    }
    .month-header {
      font-size: 1.5em;
      margin: 20px 0;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }
    .month-header a {
      text-decoration: none;
      color: #0070f3;
    }
    .nav-btn {
      cursor: pointer;
      font-size: 1.2em;
      padding: 5px 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: #f9f9f9;
    }
    .nav-btn:hover {
      background: #e0e0e0;
    }
    .today-btn {
      cursor: pointer;
      font-size: 1em;
      padding: 5px 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: #f0f0f0;
      margin-left: 10px;
    }
    .today-btn:hover {
      background: #0070f3;
      color: white;
    }
  </style>
</head>
<body>
  <div class="month-header">
    <span class="nav-btn" onclick="prevMonth()">&#8592;</span>
    <a id="month-link" href="#">Month</a>
    <span class="nav-btn" onclick="nextMonth()">&#8594;</span>
    <button class="today-btn" onclick="goToday()">Today</button>
  </div>
  <div class="calendar" id="calendar"></div>

  <script>
    const calendarEl = document.getElementById('calendar');
    const monthLink = document.getElementById('month-link');
    let currentDate = new Date();

    const notionBase = "https://www.notion.so/calendar/";

    function formatDate(year, month, day) {
      const m = String(month).padStart(2, '0');
      const d = String(day).padStart(2, '0');
      return `${year}-${m}-${d}`;
    }

    // ISO week number calculation (weeks start Monday, Thursday rule)
    function getWeekNumber(date) {
      const tempDate = new Date(date.getTime());
      tempDate.setHours(0,0,0,0);
      tempDate.setDate(tempDate.getDate() + 3 - ((tempDate.getDay() + 6) % 7));
      const week1 = new Date(tempDate.getFullYear(),0,4);
      return 1 + Math.round(((tempDate.getTime() - week1.getTime()) / 86400000
        - 3 + ((week1.getDay() + 6) % 7)) / 7);
    }

    function renderCalendar(date) {
      calendarEl.innerHTML = '';
      const year = date.getFullYear();
      const month = date.getMonth();

      const monthName = date.toLocaleString('default', { month: 'long' });
      monthLink.textContent = `${monthName} ${year}`;
      monthLink.href = `${notionBase}${year}-${String(month+1).padStart(2,'0')}`;

      const weekdays = ['Wk','Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
      weekdays.forEach(day => {
        const weekdayCell = document.createElement('div');
        weekdayCell.className = day === 'Wk' ? 'weeknum' : 'weekday';
        weekdayCell.textContent = day;
        calendarEl.appendChild(weekdayCell);
      });

      const firstDay = new Date(year, month, 1).getDay(); // 0=Sun ... 6=Sat
      const daysInMonth = new Date(year, month+1, 0).getDate();

      let dayCounter = 1;
      let started = false;

      while (dayCounter <= daysInMonth) {
        // Compute the Monday of the current week row (ISO week start)
        // Use the first real day of this row (dayCounter) to derive week start,
        // then back up to Monday even if it falls in the previous month.
        const rowFirstDate = new Date(year, month, dayCounter);
        const dayOfWeek = rowFirstDate.getDay(); // 0=Sun..6=Sat
        const mondayOffset = (dayOfWeek + 6) % 7; // 0 if Monday, 6 if Sunday
        const weekStartDate = new Date(rowFirstDate);
        weekStartDate.setDate(rowFirstDate.getDate() - mondayOffset);

        const weekNumCell = document.createElement('div');
        weekNumCell.className = 'weeknum';
        const weekLink = document.createElement('a');
        weekLink.textContent = getWeekNumber(weekStartDate);
        weekLink.href = `${notionBase}${weekStartDate.getFullYear()}-W${getWeekNumber(weekStartDate)}`;
        weekNumCell.appendChild(weekLink);
        calendarEl.appendChild(weekNumCell);

        for (let dow = 0; dow < 7; dow++) {
          if (!started && dow < firstDay) {
            const emptyCell = document.createElement('div');
            emptyCell.className = 'empty';
            calendarEl.appendChild(emptyCell);
          } else if (dayCounter <= daysInMonth) {
            started = true;
            const dayCell = document.createElement('div');
            dayCell.className = 'day';
            const dayLink = document.createElement('a');
            dayLink.textContent = dayCounter;
            dayLink.href = `${notionBase}${formatDate(year, month+1, dayCounter)}`;
            dayCell.appendChild(dayLink);

            const today = new Date();
            if (
              dayCounter === today.getDate() &&
              month === today.getMonth() &&
              year === today.getFullYear()
            ) {
              dayCell.classList.add('today');
            }

            // Weekend styling: Sun (0) and Sat (6)
            if (dow === 0 || dow === 6) {
              dayCell.classList.add('weekend');
            }

            calendarEl.appendChild(dayCell);
            dayCounter++;
          } else {
            const emptyCell = document.createElement('div');
            emptyCell.className = 'empty';
            calendarEl.appendChild(emptyCell);
          }
        }
      }
    }

    function prevMonth() {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar(currentDate);
    }

    function nextMonth() {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar(currentDate);
    }

    function goToday() {
      currentDate = new Date();
      renderCalendar(currentDate);
    }

    renderCalendar(currentDate);
  </script>
</body>
</html>
