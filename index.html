<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dynamic Notion Calendar Widget</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; font-size: small; }
    .calendar {
      display: grid;
      grid-template-columns: 40px repeat(7, 1fr);
      gap: 2px;
      max-width: 400px;
      margin: auto;
    }
    .day, .empty, .weekday, .weeknum {
      padding: 10px; border: 1px solid #ccc; border-radius: 4px;
      transition: background 0.2s, color 0.2s;
    }
    /* Week number styles */
    .weeknum { font-weight: bold; background: #fafafa; text-align: center; }
    .weeknum a { text-decoration: none; color: #0070f3; }
    .weeknum:hover { background: #0070f3; }
    .weeknum:hover a { color: white; }
    
    /* Base day styles */
    .day a {
      text-decoration: none;
      color: #333;
    }
    
    /* Weekday and weekend backgrounds */
    .day.weekday { background: #f0efeb; }   /* weekdays */
    .day.weekend { background: #ebd8dc; }   /* weekends */
    
    /* Hover overrides */
    .day.weekday:hover,
    .day.weekend:hover {
      background: #97637c;
      color: white;
      border: 2px solid #d79d31;
    }
    .day.weekday:hover a,
    .day.weekend:hover a {
      color: white;
      font-weight: bold;
    }
    
    /* Today override */
    .day.today {
      background: #a793ac;  /* force override */
      color: white !important;
      font-weight: bold;
    }
    .day.today a {
      color: white !important;
    }
    
    .month-header {
      font-size: 1.5em; margin: 20px 0; display: flex;
      justify-content: center; align-items: center; gap: 20px;
    }
    .month-header a { text-decoration: none; color: #d79d31; }
    .nav-btn {
      cursor: pointer; font-size: 1.2em; padding: 5px 10px;
      border: 1px solid #ccc; border-radius: 4px; background: #f0efeb;
    }
    .nav-btn:hover { background: #a793ac; }
    .today-btn {
      cursor: pointer; font-size: 1em; padding: 5px 15px;
      border: 1px solid #ccc; border-radius: 4px; background: #d5d5d7;
      margin-left: 10px;
    }
    .today-btn:hover { background: #a793ac; color: white; }
  </style>
</head>
<body>
  <div class="month-header">
    <span class="nav-btn" onclick="prevMonth()">&#8592;</span>
    <a id="month-link" href="#">Month</a>
    <span class="nav-btn" onclick="nextMonth()">&#8594;</span>
    <button class="today-btn" onclick="goToday()">Today</button>
  </div>
  <div class="calendar" id="calendar"></div>

  <script>
    const calendarEl = document.getElementById('calendar');
    const monthLink = document.getElementById('month-link');
    let currentDate = new Date();

    const notionBase = "https://www.notion.so/Journal/";

    function formatDate(year, month, day) {
      const m = String(month).padStart(2, '0');
      const d = String(day).padStart(2, '0');
      return `${year}-${m}-${d}`;
    }

    function getWeekNumber(date) {
      const temp = new Date(date.getTime());
      temp.setHours(0,0,0,0);
      temp.setDate(temp.getDate() + 3 - ((temp.getDay() + 6) % 7));
      const week1 = new Date(temp.getFullYear(), 0, 4);
      return 1 + Math.round(((temp - week1) / 86400000 - 3 + ((week1.getDay() + 6) % 7)) / 7);
    }

    function renderCalendar(date) {
      calendarEl.innerHTML = '';
      const year = date.getFullYear();
      const month = date.getMonth();

      const monthName = date.toLocaleString('default', { month: 'long' });
      monthLink.textContent = `${monthName} ${year}`;
      monthLink.href = `${notionBase}${year}-${String(month+1).padStart(2,'0')}`;

      const weekdays = ['Wk','Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
      weekdays.forEach(day => {
        const cell = document.createElement('div');
        // âœ… Use 'weekday' class for all headers, including 'Wk'
        cell.className = 'weekday';
        cell.textContent = day;
        calendarEl.appendChild(cell);
      });

      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month+1, 0).getDate();

      let dayCounter = 1;
      let started = false;
      let rowIndex = 0;

      const firstSundayOfGrid = new Date(year, month, 1 - firstDay);

      while (dayCounter <= daysInMonth) {
        const sundayOfRow = new Date(firstSundayOfGrid);
        sundayOfRow.setDate(firstSundayOfGrid.getDate() + rowIndex * 7);
        const mondayOfRow = new Date(sundayOfRow);
        mondayOfRow.setDate(sundayOfRow.getDate() + 1);

        const weekNumCell = document.createElement('div');
        weekNumCell.className = 'weeknum';
        const weekLink = document.createElement('a');
        const isoWeek = getWeekNumber(mondayOfRow);
        weekLink.textContent = isoWeek;
        weekLink.href = `${notionBase}${mondayOfRow.getFullYear()}-W${isoWeek}`;
        weekNumCell.appendChild(weekLink);
        calendarEl.appendChild(weekNumCell);

        for (let dow = 0; dow < 7; dow++) {
          if (!started && dow < firstDay) {
            const emptyCell = document.createElement('div');
            emptyCell.className = 'empty';
            calendarEl.appendChild(emptyCell);
          } else if (dayCounter <= daysInMonth) {
            started = true;
            const dayCell = document.createElement('div');
            dayCell.className = 'day';
            const dayLink = document.createElement('a');
            dayLink.textContent = dayCounter;
            dayLink.href = `${notionBase}${formatDate(year, month+1, dayCounter)}`;
            dayCell.appendChild(dayLink);

            const today = new Date();
            if (dayCounter === today.getDate() &&
                month === today.getMonth() &&
                year === today.getFullYear()) {
              dayCell.classList.add('today');
            }

            if (dow === 0 || dow === 6) {
              dayCell.classList.add('weekend');
            } else {
              dayCell.classList.add('weekday');
            }

            calendarEl.appendChild(dayCell);
            dayCounter++;
          } else {
            const emptyCell = document.createElement('div');
            emptyCell.className = 'empty';
            calendarEl.appendChild(emptyCell);
          }
        }
        rowIndex++;
      }
    }

    function prevMonth() { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(currentDate); }
    function nextMonth() { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(currentDate); }
    function goToday() { currentDate = new Date(); renderCalendar(currentDate); }

    renderCalendar(currentDate);
  </script>
</body>
</html>
